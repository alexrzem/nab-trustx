<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Preferred Name</title>
  <!-- Importing Material Components Web -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap"
    rel="stylesheet">
  <script type="importmap">
      {
        "imports": {
          "@material/web/": "https://esm.run/@material/web/"
        }
      }
    </script>
  <script type="module">
    import "@material/web/all.js";
    import { styles as typescaleStyles } from "@material/web/typography/md-typescale-styles.js";

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  <script type="text/javascript" src="./assets/js/moments.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="./assets/css/main.css" />
  <link rel="stylesheet" href="./assets/css/progress-expand.css" />
</head>

<body id="overlay" onload="subscribeToTrustX();">
  <div class="container">
    <div class="container-top">
      <div class="container-top-navigation">
        <md-text-button id="back-button" onclick="dispatchBack()" style="visibility: hidden;">
          <i class="material-icons">arrow_back</i>
        </md-text-button>
        <div id="navigation-parent" style="position: relative; visibility: hidden;">
          <md-text-button id="progress-expand-anchor">
            <i class="material-icons right">checklist_rtl</i>
          </md-text-button>
        </div>
      </div>
    </div>

    <div class="container-content">
      <form class="form-container">
        <div class="container-body">
          <div class="container-input-header">
            <h1>What's your preferred name?</h1>
            <p id="testid"></p>
            <p>We will use this preferred name in our communications.</p>
          </div>
          <div class="container-input-section">
            <md-outlined-text-field class="input-text" id="preferredName" label="Preferred name" type="text" inputmode="text">
            </md-outlined-text-field>
            <br />
            <small>
              We will use this name and other information provided
              for purposes related to assessing your application, interacting with
              you and verifying your identity. For more information about NAB's
              personal information handling practices, including how to lodge a
              privacy related request, enquiry or complaint, please refer to the
              <a class="privacy-link" href="#">NAB Group Privacy Notification</a>.
            </small>
          </div>
        </div>
      </form>
    </div>

    <div class="container-bottom">
      <div>
        <md-filled-button class="next-button" onclick="dispatchDataWithAnalytics()" disabled>Next</md-filled-button>
      </div>
    </div>
    <!-- <p id="fpjsId" class="input-text" style="display: none;"></p> -->
    <md-outlined-text-field class="input-text" id="fpjsId" label="fpjsid" type="text" inputmode="text" style="display: none;">
    </md-outlined-text-field>
  </div>

  <div id="nav">
    <div class="expanded-progress-header">
      <h2>Your Progress</h2>
      <md-icon-button id="expanded-progress-close-btn">
        <md-icon>close</md-icon>
      </md-icon-button>
    </div>
    
    <h4 style="margin-left: 16px; margin-right: 16px;">Application 5% complete</h4>
    <div class="progress-container" style="margin-left: 16px; margin-right: 16px;" >
      <div class="progress-bar" id="progress-bar" style="width: 5%;"></div>
    </div>
    <div class="card card-warning" style="margin-left: 16px; margin-right: 16px;">
      <div class="card-content">
        <i class="material-symbols-outlined">smartphone</i>
        <h4>Set up your NAB Access</h4>
      </div>
      <div class="application-card-icon">
        <small>In progress</small>
      </div>
    </div>

    <div class="card" style="margin-left: 16px; margin-right: 16px;">
      <div class="card-content">
        <i class="material-symbols-outlined">badge</i>
        <h4>ID Verification</h4>
      </div>
      <div class="application-card-icon">
        <md-icon>
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z"/></svg>
        </md-icon>
      </div>
    </div>

    <div class="card" style="margin-left: 16px; margin-right: 16px;">
      <div class="card-content">
        <i class="material-symbols-outlined">account_circle</i>
        <div class="card-content-with-description">
          <h4>Personal details</h4>
          <p style="color: #aaa; font-weight: 600;">About you and your situation</p>
        </div>
      </div>
      <div class="application-card-icon">
        <md-icon>
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z"/></svg>
        </md-icon>
      </div>
    </div>

    <div class="card" style="margin-left: 16px; margin-right: 16px;">
      <div class="card-content">
        <i class="material-symbols-outlined">payments</i>
        <div class="card-content-with-description">
          <h4>Your finances</h4>
          <p style="color: #aaa; font-weight: 600;">Income, expenses and debts</p>
        </div>
      </div>
      <div class="application-card-icon">
        <md-icon>
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z"/></svg>
        </md-icon>
      </div>
    </div>

    <div class="card" style="margin-left: 16px; margin-right: 16px;">
      <div class="card-content">
        <span class="material-icons">menu</span>
        <div class="card-content-with-description">
          <h4>Review your information</h4>
          <p style="color: #aaa; font-weight: 600;">Ensure your details are correct</p>
        </div>
      </div>
      <div class="application-card-icon">
        <md-icon>
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z"/></svg>
        </md-icon>
      </div>
    </div>
  </div>

  <!-- Importing Material Components Web JS -->
  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="./assets/js/main.js"></script>
  <script type="text/javascript" src="./assets/js/trustx.js"></script>
  <script>
    // Adobe analytics
    const dispatchDataWithAnalytics = () => {
      let iFrameEvent = {
        eventType: "eidv-interacted", 
        data: { 
          "componentName": "DAON eIDV App", 
          "name": "Top of Form", 
          "section": "what-shall-we-call-you?", 
          "application_id": "",
          "action": "eidv-progressed"
        }
      }

      window.top.postMessage(iFrameEvent, '*');

      // call trustx dispatch data to continue
      dispatchData()
    }

    
  </script>
  <script>
    // Fingerprint JS 

    // Initialize the agent on page load.
    const fpPromise = import('https://fpjscdn.net/v3/Nfd9YbTV0qGMObY9KJnn')
      .then(FingerprintJS => FingerprintJS.load({
        region: "eu"
      }))
  
    processCallback = (sessionData, constants) => {
      const idv = sessionData?.idv

      fpPromise
      .then(fp => fp.get({ 
        extendedResult: true,
        linkedId: sessionData.processInstanceId,
        tag: {
          "processInstanceId": sessionData.processInstanceId,
          "processDefinitionName": sessionData.processDefinitionName,
          "processDefinitionVersion": sessionData.processDefinitionName,
          "ce_entity_id": idv.config.ce_entity_id,
          "channel": idv.config.channel,
          "brand": idv.config.brand,
          "assisted": idv.config.assisted
        }
      }))
      .then(result => {
        const fpData = {
          ...result
        }
        console.log("visitorId: ", result.visitorId)
        console.log(`visitorId: ${result.visitorId} | requestId: ${result.requestId}`)
        
        const $fpEl = $('#fpjsId')
        $fpEl.val(result.requestId)
      })
      .catch(e => {
        console.error('fp error: ', e)
      })
    }
  </script>
  <script>

    // Input validation
    const checkValidName = (name) => {
      const regex = /^[a-z ,.'-]+$/i;
      const matching = regex.test(name);
      return matching;
    };

    const validate = () => {
      const $preferredNameEl = $('#preferredName')
      const preferredName = $preferredNameEl.val();

      if (!checkValidName(preferredName)) {
        disableNextButton()
      } else {
        enableNextButtons()
      }
    }

    $("#preferredName").on("input", validate)
  </script>
</body>

</html>