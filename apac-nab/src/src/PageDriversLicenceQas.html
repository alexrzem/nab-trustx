<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Review your details</title>
    <!-- Importing Material Components Web -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap"
          rel="stylesheet">
    <script type="importmap">
        {
          "imports": {
            "@material/web/": "https://esm.run/@material/web/"
          }
        }
    </script>
    <script type="module">
        import '@material/web/all.js';
        import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';

        document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
    </script>
    <script type="text/javascript" src="./assets/js/moments.js"></script>
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css"
          rel="stylesheet"/>
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" /> -->
    <link rel="stylesheet" href="./assets/css/pikaday.css"/>
    <link rel="stylesheet" href="./assets/css/main.css"/>
    <link rel="stylesheet" href="./assets/css/sheet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/zoomist@2/zoomist.css"/>
</head>

<body>
<div class="container">
    <div class="container-top">
        <div class="container-top-navigation">
            <!--        <md-text-button id="back-button" onclick="dispatchBack()">-->
            <!--          <i class="material-icons">arrow_back</i>-->
            <!--        </md-text-button>-->
            <div id="navigation-parent" style="position: relative; visibility: hidden;">
                <md-text-button id="progress-expand-anchor">
                    <i class="material-icons right">checklist_rtl</i>
                </md-text-button>
            </div>
        </div>
    </div>


    <div class="container-body">
        <div class="container-input-header">
            <h1>Confirm your details</h1>
            <div class="notification-panel notification-panel-info" style="margin-top: 24px;">
                <div class="notification-icon">
                    <i class="material-symbols-outlined">info</i>
                </div>
                <div class="notification-content">
                    Please confirm what we have captured matches your ID details, and add any information that is
                    missing.
                </div>
            </div>
        </div>
        <div class="container-input-section">

            <!-- Conditional - only shown when an error object is passed into the page -->
            <div class="notification-panel notification-panel-warning" id="dvs-fail-panel" style="margin-top: 24px;">
                <div class="notification-icon">
                    <i class="material-symbols-outlined">warning</i>
                </div>
                <div class="notification-content">
                    <p style="margin-top: 0; font-weight: 800; font-size: 1.1em;">
                        Did we get everything right?Â 
                    </p>
                    <p>
                        We were unable to verify the identity details provided. Please confirm the information
                        entered/captured is accurate. If we are unable verify this information, we will ask you provide
                        an alternate identity document.
                    </p>
                </div>
            </div>

            <div class="form-container">
                <!--<div class="card-panel" id="sticky">
                <div class="zoomist-container doc-zoomist">
                  <div class="zoomist-wrapper">
                    <div class="zoomist-image">
                      <img
                        src="./assets/img/VIC-Driver-Licence-Full.jpg"
                        alt="Victoria Driver's Licence"
                        class="licence-img"
                      />
                    </div>
                  </div>
                </div>
              </div>-->
                <div id="documentNameHeader">
                    <h3 class="review-details-section-header">Full legal name</h3>
                </div>
                <div class="radio-confirm">
                    <md-radio id="confirm-name" name="confirm-name" value="confirm-name" class="input-radio">
                    </md-radio>
                    <label class="confirm-label" for="confirm-name">Confirm</label>
                </div>

                <md-outlined-text-field id="documentFirstName" class="input-text" label="First name" type="text"
                                        inputmode="text" style="margin-top: 20px;">
                    <!--onfocus="translateToName()">-->
                </md-outlined-text-field>
                <md-outlined-text-field id="documentMiddleName" class="input-text"
                                        label="Middle name initial/s (if any)" type="text"
                                        inputmode="text"
                                        error-text="Please enter a valid name"
                                        supporting-text="Please provide your full middle name.">
                    <!--onfocus="translateToName()">-->
                </md-outlined-text-field>
                <md-outlined-text-field id="documentLastName" class="input-text" label="Surname" type="text"
                                        inputmode="text"
                                        error-text="Please enter your name">
                    <!-- onfocus="translateToName()"> -->
                </md-outlined-text-field>


                <div id="documentDateOfBirthHeader">
                    <h3 class="review-details-section-header">Date of birth</h3>
                </div>
                <div class="radio-confirm">
                    <md-radio id="confirm-dob" name="confirm-dob" value="confirm-dob" class="input-radio">
                    </md-radio>
                    <label class="confirm-label" for="confirm-dob">Confirm</label>
                </div>

                <md-outlined-text-field class="input-text" id="documentDateOfBirth" label="Date of birth" type="text"
                                        inputmode="text" style="margin-top: 20px;" data-trustx-map-date="true"
                                        error-text="Please ensure that the applicant is 14 years of age or older">
                    <!-- onfocus="translateToDOB()"> -->
                    <md-icon class="material-icons btn-calendar" slot="trailing-icon" role="button"
                             id="dob-icon">event
                    </md-icon>
                </md-outlined-text-field>


                <div id="documentDetailsHeader">
                    <h3 class="review-details-section-header">Driver licence details</h3>
                </div>
                <div class="radio-confirm">
                    <md-radio id="confirm-doc-details" name="confirm-doc-details" value="confirm-doc-details"
                              class="input-radio">
                    </md-radio>
                    <label class="confirm-label" for="confirm-doc-details">Confirm</label>
                </div>

                <md-outlined-select id="documentIssuingState" class="input-select review-details-select"
                                    label="State of issue"
                                    style="margin-top: 20px; margin-bottom: 20px; width: 100%;">
                    <md-select-option value="ACT">
                        <div slot="headline">ACT</div>
                    </md-select-option>
                    <md-select-option value="NSW">
                        <div slot="headline">New South Wales</div>
                    </md-select-option>
                    <md-select-option value="VIC">
                        <div slot="headline">Victoria</div>
                    </md-select-option>
                    <md-select-option value="QLD">
                        <div slot="headline">Queensland</div>
                    </md-select-option>
                    <md-select-option value="WA">
                        <div slot="headline">Western Australia</div>
                    </md-select-option>
                    <md-select-option value="TAS">
                        <div slot="headline">Tasmania</div>
                    </md-select-option>
                    <md-select-option value="SA">
                        <div slot="headline">South Australia</div>
                    </md-select-option>
                    <md-select-option value="NT">
                        <div slot="headline">Northern Territory</div>
                    </md-select-option>
                </md-outlined-select>

                <md-outlined-text-field id="documentNumber" class="input-text" label="Licence number" type="text"
                                        inputmode="text"
                                        error-text="Enter a valid licence number"
                                        supporting-text="The licence number is located on the top right hand corner of the card.">
                    <!--onfocus="translateToLicNo()">-->
                </md-outlined-text-field>
                <md-outlined-text-field id="documentCardNumber" class="input-text" label="Card number" type="text"
                                        error-text="Enter a valid card number"
                                        inputmode="text"
                                        supporting-text="The card number has 8 alphanumeric characters, located at the back of the card in the middle on the right or on the top right. If you've been issued with an address label, use the new card number provided.">
                </md-outlined-text-field>
                <md-outlined-text-field class="input-text" id="documentDateOfExpiry" label="Date of Expiry" type="text"
                                        data-trustx-map-date="true"
                                        inputmode="text" style="margin-bottom: 20px;"
                                        error-text="Please ensure that licence is still valid"
                                        supporting-text="Input format should be DD/MM/YYYY.">
                    <!-- onfocus="translateToLicExp()"> -->
                    <md-icon class="material-icons btn-calendar" slot="trailing-icon" role="button"
                             id="doe-icon">event
                    </md-icon>
                </md-outlined-text-field>

                <div id="documentAddressHeader" style="margin-bottom: 20px">
                    <h3 class="review-details-section-header" style="margin-bottom: 10px">Address details</h3>
                    <div>
                    Enter your home address. We can't accept a PO Box.
                    </div>
                </div>
                <div class="radio-confirm">
                    <md-radio id="confirm-address" name="confirm-address" value="confirm-address" class="input-radio">
                    </md-radio>
                    <label class="confirm-label" for="confirm-address">Confirm</label>
                </div>

                <div id="addressAutocomplete" style="display: block; position: relative;">
                    <md-outlined-text-field
                            id="addressSearchInput"
                            class="input-text"
                            label="Address"
                            type="text"
                            inputmode="text"
                            aria-controls="addressSuggestions"
                            aria-autocomplete="list"
                            aria-expanded="false"
                            role="combobox">

                        <md-icon slot="leading-icon"
                                 class="material-icons btn-search"
                                 role="button"
                                 id="search-icon">
                            search
                        </md-icon>

                        <md-icon
                                id="addressClearButton"
                                onclick="clearNabAddress()"
                                style="display: none; cursor: pointer; pointer-events: auto"
                                class="material-icons btn-close"
                                slot="trailing-icon"
                                role="button">
                            close
                        </md-icon>
                    </md-outlined-text-field>

                    <md-menu
                            id="addressSuggestions"
                            role="listbox"
                            aria-label="Address Suggestions"
                            style="min-width: 100%">
                    </md-menu>
                </div>

                <md-text-button class="button-get-another-code" onclick="toggleAddressSearch()" id="addressManualLink">
                    Enter address manually
                </md-text-button>


                <div id="addressForm" style="display: none">

                    <md-outlined-select id="documentAddressCountry" class="input-select review-details-select"
                                        label="Country" disabled="true" value="AU"
                                        style="margin-bottom: 24px; width: 100%;">
                        <md-select-option value="AU">
                            <div slot="headline">Australia</div>
                        </md-select-option>
                    </md-outlined-select>

                    <md-outlined-text-field id="documentAddressBuildingPropertyName" class="input-text"
                                            label="Building name (optional)" type="text"
                                            inputmode="text" style="margin-bottom: 24px;">
                    </md-outlined-text-field>

                    <!-- Not currently present in requirements or Figma's, but needed for validation and passthrough purposes -->
                    <md-outlined-text-field id="documentAddressLevelNumber" class="input-text"
                                            label="Level number (optional)" type="text"
                                            inputmode="text" style="margin-bottom: 24px; display: none;">
                    </md-outlined-text-field>

                    <md-outlined-text-field id="documentAddressUnitNumber" class="input-text"
                                            label="Flat / Unit number (optional)" type="text"
                                            inputmode="text" style="margin-bottom: 24px;">
                    </md-outlined-text-field>

                    <md-outlined-text-field id="documentAddressStreetNumber" class="input-text" label="Street number"
                                            type="text"
                                            inputmode="text" style="margin-bottom: 24px;"
                                            error-text="Please enter your street number">
                    </md-outlined-text-field>

                    <md-outlined-text-field id="documentAddressStreetName" class="input-text" label="Street Name"
                                            type="text"
                                            inputmode="text" style="margin-bottom: 24px;">
                    </md-outlined-text-field>


                    <md-outlined-select id="documentAddressStreetType" class="input-select review-details-select"
                                        label="Street type"
                                        style="margin-bottom: 24px; width: 100%;">
                    </md-outlined-select>


                    <md-outlined-text-field id="documentAddressPostalCode" class="input-text" label="Postcode/zip"
                                            type="text"
                                            inputmode="text" style="margin-bottom: 24px;">
                    </md-outlined-text-field>

                    <md-outlined-text-field id="documentAddressSuburb" class="input-text" label="City/town"
                                            type="text"
                                            inputmode="text" style="margin-bottom: 24px;">
                    </md-outlined-text-field>

                    <md-outlined-select id="documentAddressState" class="input-select review-details-select" label="State" style="margin-bottom: 20px; width: 100%;">
                        <md-select-option value="ACT">
                            <div slot="headline">ACT</div>
                        </md-select-option>
                        <md-select-option value="NSW">
                            <div slot="headline">New South Wales</div>
                        </md-select-option>
                        <md-select-option value="NT">
                            <div slot="headline">North Territory</div>
                        </md-select-option>
                        <md-select-option value="QLD">
                            <div slot="headline">Queensland</div>
                        </md-select-option>
                        <md-select-option value="SA">
                            <div slot="headline">South Australia</div>
                        </md-select-option>
                        <md-select-option value="TAS">
                            <div slot="headline">Tasmania</div>
                        </md-select-option>
                        <md-select-option value="VIC">
                            <div slot="headline">Victoria</div>
                        </md-select-option>
                        <md-select-option value="WA">
                            <div slot="headline">Western Australia</div>
                        </md-select-option>
                    </md-outlined-select>

                    <div class="notification-panel notification-panel-error" style="margin-bottom: 24px; display: none;"
                         id="postcodeError">
                        <div class="notification-icon">
                            <i class="material-symbols-outlined error">error</i>
                        </div>
                        <div class="notification-content">
                            <p style="margin-top: 0; margin-bottom: 0;">
                                There is a mismatch between state, suburb and/or postcode. Please review and correct
                                your details.
                            </p>
                        </div>
                    </div>

                    <md-text-button class="button-get-another-code" onclick="toggleAddressSearch()">
                        Enter address using quick search
                    </md-text-button>
                </div>


	          <div class="container-bottom">
	            <div>
	              <!-- <md-outlined-button class="branded brand-wlkogan back-button" onclick="dispatchBack()">Back</md-outlined-button> -->
	              <md-text-button class="branded brand-default brand-wlkogan back-button-text" style="visibility: hidden;" onclick="dispatchBack()">Change ID document type</md-text-button>
	            </div>
	            <div>
	              <md-filled-button class="next-button" onclick="validateAndDispatchData()">Next</md-filled-button>
	            </div>
	          </div>


            </div>
        </div>


    </div>

    <script>
        const currentPage = 'PageDriversLicenceQas'
    </script>
    <!-- Importing Material Components Web JS -->
    <script src="https://cdn.jsdelivr.net/npm/zoomist@2/zoomist.umd.js"></script>
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <script type="text/javascript" src="./assets/js/pikaday.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="./assets/js/error.js"></script>
    <script type="text/javascript" src="./assets/js/validation.js"></script>
    <script type="text/javascript" src="./assets/js/address-validation-v2.js"></script>
    <script type="text/javascript" src="./assets/js/address-validation.js"></script>
    <script type="text/javascript" src="./assets/js/main.js"></script>
    <script type="text/javascript" src="./assets/js/sheet.js"></script>
    <script type="text/javascript" src="./assets/js/trustx.js"></script>
    <script>


    </script>
    <script>
        analyticsSectionName = 'confirm-your-ID-details'
        pageIdType = 'Australian Drivers Licence'
        // const zoomist = new Zoomist(".doc-zoomist", {
        //   maxScale: 5,
        //   slider: false,
        //   zoomer: false,
        // });

        // console.log(`zoomist.transform: ${zoomist.transform}`);
        // console.log(`zoomist.transform: ${zoomist.transform}`);
        // console.log(`zoomist.data: ${zoomist.data}`);

        // // Scale
        // const zoomScale = 2;
        // // Container
        // const containerWidth = zoomist.data.containerData.width;
        // const containerHeight = zoomist.data.containerData.height;
        // console.log(
        //   `container: { width: ${containerWidth}, height: ${containerHeight} }`
        // );
        // // Image
        // const imageWidth = zoomist.data.imageData.width;
        // const imageHeight = zoomist.data.imageData.height;
        // console.log(`image: { width: ${imageWidth}, height: ${imageHeight} }`);

        // // Initial zoom scale
        // zoomist.zoomTo(1);

        // // scale = 2 | TOP LEFT COORDINATE x: 400, y: 263

        // // VIC DL - name fields
        // // container width: 800px
        // // scale 1 | x: 0
        // // scale 2 | x: 400
        // // scale 3 | x: 800 (container w)
        // // scale 4 | x: 1200
        // // ...
        // const leftMostX = (containerWidth / 2) * (zoomScale - 1);

        // // scale 1 | y: 0
        // // scale 2 | x: 263
        // // scale 3 | x: 527 (container h)
        // // scale 4 | x: 791
        // // ...
        // const topMostY = (containerHeight / 2) * (zoomScale - 1);

        // // normalised (0,0)
        // let x = leftMostX;
        // let y = topMostY;

        // const moveRightByWidthPercent = (percent) => {
        //   // whole number, e.g. moveRightByWidthPercent(50) is 50% of the container width to the right
        //   x = leftMostX - (percent * containerWidth) / 100;
        //   console.log(`x: ${x}`);
        //   zoomist.moveTo({ x: x, y: y });
        // };

        // const moveDownByHeightPercent = (percent) => {
        //   // whole number, e.g. moveDownByHighPercent(50) is 50% of the container height down
        //   y = topMostY - (percent * containerHeight) / 100;
        //   console.log(`y: ${y}`);
        //   zoomist.moveTo({ x: x, y: y });
        // };

        // // moveRightByWidthPercent(100)
        // // moveDownByHighPercent(100)

        // const mapping = {
        //   dl: {
        //     vic: {
        //       name: {
        //         width: 0,
        //         height: 0,
        //       },
        //       address: {
        //         width: 0,
        //         height: 20,
        //       },
        //       dob: {
        //         width: 50,
        //         height: 50,
        //       },
        //       licno: {
        //         width: 100,
        //         height: 0,
        //       },
        //       licexp: {
        //         width: 0,
        //         height: 60,
        //       },
        //       licType: {
        //         width: 0,
        //         height: 90,
        //       },
        //       licState: {
        //         width: 50,
        //         height: 0,
        //       },
        //     },
        //   },
        // };

        // const resetScale = () => {
        //   zoomist.zoomTo(1);
        // };

        // const translate = (coordinate) => {
        //   zoomist.zoomTo(zoomScale);
        //   moveRightByWidthPercent(coordinate.width);
        //   moveDownByHeightPercent(coordinate.height);
        // };

        // const translateToName = () => translate(mapping.dl.vic.name);
        // const translateToAddress = () => translate(mapping.dl.vic.address);
        // const translateToDOB = () => translate(mapping.dl.vic.dob);
        // const translateToLicNo = () => translate(mapping.dl.vic.licno);
        // const translateToLicExp = () => translate(mapping.dl.vic.licexp);
        // const translateToLicType = () => translate(mapping.dl.vic.licType);
        // const translateToLicState = () => translate(mapping.dl.vic.licState);


        // zoomist.on("drag", (zoomist, transform, event) => {
        //   console.log(
        //     `drag | transform: {x: ${transform.x}, y: ${transform.y}})`
        //   );
        // });

        const thisYear = new Date().getFullYear()
        const twoYearsAgo = new Date(new Date().setFullYear(thisYear - 2))

        const dobPicker = new Pikaday({
            field: document.getElementById("documentDateOfBirth"),
            format: "DD/MM/YYYY",
            yearRange: [1900, thisYear],
            maxDate: new Date(),
            theme: 'month-year-dropdown',
            keyboardInput: false,
        });

        const doePicker = new Pikaday({
            field: document.getElementById("documentDateOfExpiry"),
            format: "DD/MM/YYYY",
            yearRange: [twoYearsAgo, thisYear + 20],
            minDate: twoYearsAgo,
            theme: 'month-year-dropdown',
            keyboardInput: false,
        });

        // jquery - Out of focus reset scale back to 1
        // $(() => {
        //   $("md-outlined-text-field").on('focusout', () => {
        //     resetScale()
        //   })
        // });
    </script>
    <script>


        // Validation
        let bypassValidation = false

        // If we get docAuthBypass from the process, then we always enable Next button
        processCallback = (sessionData, constants) => {
            this.sessionData = sessionData;

            brand = sessionData.idv.config?.brand ?? 'default';
            if (!customisedBrands.includes(brand))
                brand = 'default'

            const isUiValidationBypassedStr = sessionData.idv.config.uiValidationBypass ?? ''

            console.log('isUiValidationBypassedStr: ', isUiValidationBypassedStr)

            if (isUiValidationBypassedStr !== '' && isUiValidationBypassedStr != '0') {
                bypassValidation = true
            }

            const navigatedFromDocSelection = sessionData?.idv?.navigatedFromDocSelection ?? false
            if(navigatedFromDocSelection) {
                console.log('Navigated From DS') //TODO Remove Log, after diagnosis
                attemptOcrAddressFind();
            } else {
                console.log('Not Navigated From DS') //TODO Remove Log, after diagnosis
            }

            //TODO Extract to method
            const consistentDocumentActive = sessionData?.idv?.consistentDocumentActive ?? false             
            if (consistentDocumentActive) {
                try {
                //This is when need to validate matrix has to get rid
                //of 'addressSearchInput' as control flow to this block means its gonna be manual address
                const newNeedToValidateMatrix = new Set(needToValidateMatrix)
                console.log('Remove addressSearchInput from needToValidateMatrix')
                newNeedToValidateMatrix.delete('addressSearchInput')
                needToValidateMatrix = newNeedToValidateMatrix;
                } catch (error) {
                    console.log('Error during delete addressSearchInput from needtovalidatematrix' + e)
                }        
            }            
        }


        // Field-level validation
        function validateInputFields(idToCheck) {
            // Name
            if (idToCheck === undefined || idToCheck === 'documentFirstName')
	         validateFirstName($('#documentFirstName'), $('#documentMiddleName'), $('#documentLastName'))
            if (idToCheck === undefined || idToCheck === 'documentMiddleName')
	            validateMiddleName($('#documentMiddleName'))
            if (idToCheck === undefined || idToCheck === 'documentLastName')
	            validateLastName($('#documentLastName'), $('#documentMiddleName'), $('#documentFirstName'))

            // Document
            if (idToCheck === undefined || idToCheck === 'documentIssuingState')
                validateDocumentIssuingState($('#documentIssuingState'))
            if (idToCheck === undefined || idToCheck === 'documentNumber')
                validateLicenceNumber($('#documentNumber'))
            if (idToCheck === undefined || idToCheck === 'documentCardNumber')
                validateCardNumber($('#documentCardNumber'))

            // Dates
            if (idToCheck === undefined || idToCheck === 'documentDateOfBirth')
                validateDOB($('#documentDateOfBirth'))
            if (idToCheck === undefined || idToCheck === 'documentDateOfExpiry')
                validateDOE($('#documentDateOfExpiry'))

            // Address validation is done separately for the individual fields to avoid duplicated logic
            if (idToCheck === undefined)
                validateAddressFields();

            // Validate input matrix - only if docAuthBypass is not used or set to 0
            if (!bypassValidation) {
                return validateInputs()
            }


            return true
        }

        function validateAndDispatchData() {
            if (validateInputFields())
                dispatchData({documentAddressStreetAddress: getDataZooAddress()}); // NB-777 
        }


        // Compare matrices every time there is a change in any of the fields
        // $(".input-text, .input-select, md-radio").on("change input", validateInputs)
        // Also check general validity
        // TODO: Need to refactor this
        // $(".input-text, .input-select, .input-radio").on("change input", validateOCRData)
        $(".input-text, .input-select, md-radio").on("change input", (event) => {
            validateInputFields(event.target.id)
        })

        handleFieldBlurAndRecordErrorForAnalytics(analyticsSectionName)

        onFocusKeepElementsInView();
    </script>
</div>
</body>

</html>
